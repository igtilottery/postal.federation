{"version":3,"sources":["postal.federation.js"],"names":["n","e","exports","module","require","define","amd","postalFedx","_","postal","window","t","i","o","l","call","m","c","d","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","__esModule","create","bind","prototype","hasOwnProperty","p","s","TypeError","length","configurable","writable","key","u","apply","this","Array","slice","arguments","h","f","_transports","transport","a","forEach","disconnect","target","instanceId","doNotNotify","b","g","some","configuration","resolver","compare","_config","filterMode","enabled","I","_ready","k","packingSlip","type","Error","_inboundQueue","push","M","x","signalReady","j","send","D","onFederatedMsg","createUUID","substr","Math","floor","random","join","publish","channel","SYSTEM_CHANNEL","topic","data","oldId","newId","ping","timeStamp","Date","ticket","pong","pingData","message","envelope","bundle","packingSlips","filterDirection","_clients","_outboundQueue","_signalQueue","in","out","y","federation.ping","source","setInstanceId","handshakeComplete","sendPong","sendBundle","federation.pong","pings","callback","includes","remoteId","localId","federation.disconnect","without","transportName","federation.message","lastSender","federation.bundle","extend","S","v","w","options","originId","clone","knownIds","concat","shouldProcess","fedx","FederationClient","handlers","clients","transports","filters","addFilter","isArray","direction","removeFilter","canSendRemote","configure","defaults","getPackingSlip","sendMessage","_getTransports","reduce","addWireTap","subscribe","shift"],"mappings":"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","file":"postal.federation.min.js","sourcesContent":["/*!\n *  * postal.federation - A base plugin for federating instances of postal.js across various boundaries.\n *  * Author: Jim Cowart (http://ifandelse.com)\n *  * Version: v0.5.5\n *  * Url: http://github.com/postaljs/postal.federation\n *  * License(s): (MIT OR GPL-2.0)\n */\n!function(n,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e(require(\"lodash\"),require(\"postal\")):\"function\"==typeof define&&define.amd?define([\"lodash\",\"postal\"],e):\"object\"==typeof exports?exports.postalFedx=e(require(\"lodash\"),require(\"postal\")):n.postalFedx=e(n._,n.postal)}(window,function(n,e){return function(n){var e={};function t(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return n[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=n,t.c=e,t.d=function(n,e,i){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:i})},t.r=function(n){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(n,\"__esModule\",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&\"object\"==typeof n&&n&&n.__esModule)return n;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:n}),2&e&&\"string\"!=typeof n)for(var o in n)t.d(i,o,function(e){return n[e]}.bind(null,o));return i},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,\"a\",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p=\"\",t(t.s=4)}([function(e,t){e.exports=n},function(n,t){n.exports=e},function(n,e){n.exports=function(n,e){if(!(n instanceof e))throw new TypeError(\"Cannot call a class as a function\")}},function(n,e){function t(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}n.exports=function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}},function(n,e,t){\"use strict\";t.r(e);var i,o,a=t(0),r=t.n(a),c=t(1),s=t.n(c);function u(n){if(Object.prototype.hasOwnProperty.call(d,n))return d[n].apply(this,Array.prototype.slice.call(arguments,1))}s.a.createUUID||(s.a.createUUID=function(){for(var n=[],e=0;e<36;e++)n[e]=\"0123456789abcdef\".substr(Math.floor(16*Math.random()),1);return n[14]=\"4\",n[19]=\"0123456789abcdef\".substr(3&n[19]|8,1),n[8]=n[13]=n[18]=n[23]=\"-\",n.join(\"\")}),s.a.instanceId||(s.a.instanceId=function(n){return n&&(o=i,i=n,s.a.publish({channel:s.a.configuration.SYSTEM_CHANNEL,topic:\"instanceId.changed\",data:{oldId:o,newId:i}})),i});var d={ping:function(){return{type:\"federation.ping\",instanceId:s.a.instanceId(),timeStamp:new Date,ticket:s.a.createUUID()}},pong:function(n){return{type:\"federation.pong\",instanceId:s.a.instanceId(),timeStamp:new Date,pingData:{instanceId:n.instanceId,timeStamp:n.timeStamp,ticket:n.ticket}}},message:function(n){return{type:\"federation.message\",instanceId:s.a.instanceId(),timeStamp:new Date,envelope:n}},disconnect:function(){return{type:\"federation.disconnect\",instanceId:s.a.instanceId(),timeStamp:new Date}},bundle:function(n){return{type:\"federation.bundle\",instanceId:s.a.instanceId(),timeStamp:new Date,packingSlips:n}}},p={enabled:!0,filterMode:\"whitelist\",filterDirection:\"both\"},l=function(){},f={_clients:[],_transports:{},_ready:!1,_inboundQueue:[],_outboundQueue:[],_signalQueue:[],_config:p};function h(n){n=n||{};var e=f._transports;n.transport&&((e={})[n.transport]=f._transports[n.transport]),r.a.forEach(e,function(e){e.disconnect({target:n.target,instanceId:n.instanceId,doNotNotify:!!n.doNotNotify})})}var g={in:{},out:{}},y=g;function b(n,e,t){var i=Object.prototype.hasOwnProperty.call(g[t],n),o=i&&r.a.some(g[t][n],function(n){return s.a.configuration.resolver.compare(n,e)}),a=\"blacklist\"===f._config.filterMode;return f._config.enabled&&(a&&(!i||i&&!o)||!a&&i&&o)}var k={\"federation.ping\":function(n){n.source.setInstanceId(n.packingSlip.instanceId),n.source.handshakeComplete?n.source.sendPong(n.packingSlip):n.source.sendBundle([u(\"pong\",n.packingSlip),u(\"ping\")])},\"federation.pong\":function(n){n.source.handshakeComplete=!0,n.source.setInstanceId(n.packingSlip.instanceId),n.source.pings[n.packingSlip.pingData.ticket]&&(n.source.pings[n.packingSlip.pingData.ticket].callback({ticket:n.packingSlip.pingData.ticket,instanceId:n.packingSlip.instanceId,source:n.source}),n.source.pings[n.packingSlip.pingData.ticket]=void 0),r.a.includes(f._clients,n.packingSlip.instanceId)||f._clients.push(n.packingSlip.instanceId),s.a.publish({channel:\"postal.federation\",topic:\"client.federated\",data:{remoteId:n.source.instanceId,localId:s.a.instanceId(),transport:n.transport}})},\"federation.disconnect\":function(n){f._clients=r.a.without(f._clients,n.source.instanceId),h({transport:n.source.transportName,instanceId:n.source.instanceId,doNotNotify:!0})},\"federation.message\":function(n){var e=n.packingSlip.envelope;b(e.channel,e.topic,\"in\")&&(e.lastSender=n.packingSlip.instanceId,s.a.publish(e))},\"federation.bundle\":function(n){r.a.forEach(n.packingSlip.packingSlips,function(e){I(r.a.extend({},n,{packingSlip:e}))})}};function I(n){if(f._ready){if(!Object.prototype.hasOwnProperty.call(k,n.packingSlip.type))throw new Error(\"postal.federation does not have a message handler for '\"+n.packingSlip.type+\"'.\");k[n.packingSlip.type](n)}else f._inboundQueue.push(n)}var m=t(2),_=t.n(m),S=t(3),v=t.n(S),w=function(){function n(e,t,i){_()(this,n),this.target=e,this.options=t||{},this.pings={},this.instanceId=i,this.handshakeComplete=!1}return v()(n,[{key:\"sendPing\",value:function(n){var e=u(\"ping\");this.pings[e.ticket]={ticket:e.ticket,callback:n||l},this.send(e)}},{key:\"sendPong\",value:function(n){this.send(u(\"pong\",n))}},{key:\"sendBundle\",value:function(n){this.send(u(\"bundle\",n))}},{key:\"sendMessage\",value:function(n){if(this.handshakeComplete){n.originId=n.originId||s.a.instanceId();var e=r.a.clone(n);!this.instanceId||this.instanceId===e.lastSender||e.knownIds&&e.knownIds.length&&(!e.knownIds||r.a.includes(e.knownIds,this.instanceId))||(e.knownIds=(e.knownIds||[]).concat(r.a.without(f._clients,this.instanceId)),this.send(u(\"message\",e)))}}},{key:\"disconnect\",value:function(){this.send(u(\"disconnect\"))}},{key:\"onMessage\",value:function(n){this.shouldProcess()&&I({transport:this.transportName,packingSlip:n,source:this})}},{key:\"shouldProcess\",value:function(){return!0}},{key:\"send\",value:function(){throw new Error(\"An object deriving from FederationClient must provide an implementation for 'send'.\")}},{key:\"setInstanceId\",value:function(n){this.instanceId=n}}],[{key:\"extend\",value:function(e,t){function i(){n.apply(this,arguments)}return i.prototype=Object.create(n.prototype),r.a.extend(i.prototype,e),r.a.extend(i,t),i}}]),n}(),x=s.a.fedx={FederationClient:w,packingSlips:d,handlers:k,clients:f._clients,transports:f._transports,filters:y,addFilter:function(n){n=r.a.isArray(n)?n:[n],r.a.forEach(n,function(n){n.direction=n.direction||f._config.filterDirection,r.a.forEach(\"both\"===n.direction?[\"in\",\"out\"]:[n.direction],function(e){g[e][n.channel]?r.a.includes(g[e][n.channel],n.topic)||g[e][n.channel].push(n.topic):g[e][n.channel]=[n.topic]})})},removeFilter:function(n){n=r.a.isArray(n)?n:[n],r.a.forEach(n,function(n){n.direction=n.direction||f._config.filterDirection,r.a.forEach(\"both\"===n.direction?[\"in\",\"out\"]:[n.direction],function(e){g[e][n.channel]&&r.a.includes(g[e][n.channel],n.topic)&&(g[e][n.channel]=r.a.without(g[e][n.channel],n.topic))})})},canSendRemote:function(n,e){return b(n,e,\"out\")},configure:function(n){if(n&&n.filterMode&&\"blacklist\"!==n.filterMode&&\"whitelist\"!==n.filterMode)throw new Error(\"postal.fedx filterMode must be 'blacklist' or 'whitelist'.\");return n&&(f._config=r.a.defaults(n,p)),f._config},getPackingSlip:u,onFederatedMsg:I,sendMessage:function(n){f._ready?r.a.forEach(this.transports,function(e){e.sendMessage(n)}):f._outboundQueue.push(arguments)},disconnect:h,_getTransports:function(){return r.a.reduce(this.transports,function(n,e,t){return n[t]=!0,n},{})},signalReady:function(n,e,t){if(f._ready){var i=this._getTransports();switch(arguments.length){case 1:\"function\"==typeof n?t=n:\"string\"==typeof n&&((i={})[n]=this.transports[n],t=l);break;case 2:\"string\"==typeof n?(i={})[n]=this.transports[n]:i=n,t=e||l;break;case 3:(i={})[n]=[e]}r.a.forEach(i,r.a.bind(function(n,e){n=\"boolean\"==typeof n?[]:n,this.transports[e].signalReady(n,t)},this))}else f._signalQueue.push(arguments)}};e.default=x;function M(n){x.signalReady.apply(this,n)}function j(n){x.send.apply(this,n)}function D(n){x.onFederatedMsg.call(this,n)}s.a.addWireTap(function(n,e){x.canSendRemote(e.channel,e.topic)&&x.sendMessage(e)}),s.a.subscribe({channel:s.a.configuration.SYSTEM_CHANNEL,topic:\"instanceId.changed\",callback:function(){for(f._ready=!0;f._signalQueue.length;)M(f._signalQueue.shift());for(;f._outboundQueue.length;)j(f._outboundQueue.shift());for(;f._inboundQueue.length;)D(f._inboundQueue.shift())}}),void 0!==s.a.instanceId()&&(f._ready=!0)}])});"]}